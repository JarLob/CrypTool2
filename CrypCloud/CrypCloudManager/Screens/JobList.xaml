<UserControl x:Class="CrypCloud.Manager.Screens.JobList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:CrypCloud.Manager.ViewModels"
             xmlns:converter="clr-namespace:CrypCloud.Manager.Screens.Converter"
             xmlns:pocos="clr-namespace:CrypCloud.Manager.ViewModels.Pocos"
             mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <converter:BoolToVisibilityConverter FalseValue="Collapsed" x:Key="show" />
            <converter:BoolToVisibilityConverter TrueValue="Collapsed" FalseValue="Visible" x:Key="hide" />
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Styles/Button.xaml" />
                <ResourceDictionary Source="Styles/ProgressBar.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.DataContext>
        <viewModels:JobListVM />
    </UserControl.DataContext>

    <StackPanel Visibility="{Binding Path=IsActive, Converter={StaticResource show}}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="30">
        <!-- bottom controls -->
        <Grid >
            <Label Content="{Loc _JobList_Header}" FontSize="14" HorizontalAlignment="Center" Margin="30"/>
            <Button Command="{Binding Path=LogOutCommand}" HorizontalAlignment="Right" Margin="5" Width="100" Height="30">
                <StackPanel Orientation="Horizontal">
                    <Image Source="../Images/ButtonIcons/sign-out.png"  Width="16" />
                    <Label Content="{Loc _JobList_btn_logout}" />
                </StackPanel>
            </Button>

        </Grid>
        
        <!-- errorBox -->
        <Border Visibility="{Binding Path=ErrorMessage, Converter={converter:StringNullOrEmptyToVisibilityConverter}}"
               CornerRadius="5" BorderThickness="3" BorderBrush="Gold">
            <Grid>
                <Grid.Background>
                    <SolidColorBrush Color="Khaki" />
                </Grid.Background>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Image Name="Erroricon" Width="25" Grid.Row="1" Source="..\..\images\error.png"
                       HorizontalAlignment="Left" />
                <TextBlock Text="{Binding Path=ErrorMessage}" Foreground="Red" Margin="35,0,0,0" Grid.Row="1"
                           Grid.ColumnSpan="2" TextWrapping="Wrap" />
            </Grid>
        </Border>

        <ListView ScrollViewer.HorizontalScrollBarVisibility="Auto" ItemsSource="{Binding Path=RunningJobs}" Height="470" x:Name="JobListView">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="{Loc _JobList_col_Id}" DisplayMemberBinding="{Binding PrintableID}" Width="250" />
                    <GridViewColumn Header="{Loc  _JobList_col_Name}" DisplayMemberBinding="{Binding Name}" Width="100" />
                    <GridViewColumn Header="{Loc  _JobList_col_Creator}" DisplayMemberBinding="{Binding Creator}" Width="100" />
                    <GridViewColumn Header="{Loc _JobList_col_Progress}" Width="330" >
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <ProgressBar Name="progress" DataContext="{Binding}" Minimum="0" Maximum="100" 
                                             Value="{Binding ProgressPercentage}" Width="340" Height="25" />
                                    <TextBlock DataContext="{Binding}" Text="{Binding ProgressTotal}" 
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="" Width="110" >
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel  Orientation="Horizontal">
                                    <Button Command="{Binding DataContext.OpenJobCommand, ElementName=JobListView}" 
                                             CommandParameter="{Binding}" DataContext="{Binding}"
                                             Width="80" Margin="10, 5" >
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="../Images/ButtonIcons/external-link.png" Width="16" />
                                            <Label Content="{Loc _JobList_btn_open}" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="" Width="110" >
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel  Orientation="Horizontal">
                                    <Button Visibility="{Binding Path=UserCanDeleteJob, Converter={StaticResource show}}" 
                                            Command="{Binding DataContext.DeleteJobCommand, ElementName=JobListView}" 
                                            CommandParameter="{Binding}" DataContext="{Binding}"
                                            Width="80" Margin="10, 5" >
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="../Images/ButtonIcons/trash-o.png" Width="16" />
                                            <Label Content="{Loc _JobList_btn_delete}" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="FontFamily" Value="Courier New" />
                </Style>
            </ListView.ItemContainerStyle> 
        </ListView>

        <!-- bottom controls -->
        <Grid VerticalAlignment="Bottom" >
            <Button Command="{Binding Path=RefreshJobListCommand}" HorizontalAlignment="Left" Margin="5"  Width="100" Height="30">
                <StackPanel Orientation="Horizontal">
                    <Image Source="../Images/ButtonIcons/refresh.png" Width="16" />
                    <Label Content="{Loc _JobList_btn_refresh}" />
                </StackPanel>
            </Button>

            <Button Command="{Binding Path=CreateNewJobCommand}" HorizontalAlignment="Right" Margin="5" Width="100" Height="30">
                <StackPanel Orientation="Horizontal">
                    <Image Source="../Images/ButtonIcons/plus.png"  Width="16" />
                    <Label Content="{Loc _JobList_btn_createNew}" />
                </StackPanel>
            </Button>

        </Grid>
    </StackPanel>
</UserControl>
